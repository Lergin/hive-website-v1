<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="hive-profile-styles.html">
<link rel="import" href="hive-profile-game-tab.html">
<link rel="import" href="hive-game-player-info-card.html">
<link rel="import" href="hive-achievements-card.html">
<link rel="import" href="pprdash-count.html">
<link rel="import" href="chart-js.html">
<link rel="import" href="my-icons.html">

<link rel="import" href="hive-api-player.html">

<dom-module  id="hive-profile">
  <template>
    <style include="hive-profile-styles">
      :host {
        display: block;
        margin-top: 20px;
    
      }

      .icon-big {
        --iron-icon-height: 32px;
    --iron-icon-width: 32px;
      }
    </style>

    <hive-api-player 
      player="Lergin_"
      name="{{username}}"
      uuid="{{uuid}}"
      info="{{info}}"
    ></hive-api-player>

<div class="wrapper" >
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Tokens"
            value="[[info.tokens]]"
            icon="my-icons:ti-money"
            type="warning"
          ></pprdash-count>
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Medals"
            value="[[info.medals]]"
            icon="my-icons:ti-medall"
            type="success"
          ></pprdash-count>
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Achievements"
            value="232"
            icon="my-icons:ti-rocket"
            type="danger"
          ></pprdash-count>
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Trophies"
            value="[[info.trophies.length]]"
            icon="my-icons:ti-cup"
            type="warning"
          ></pprdash-count>
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Crates"
            value="[[info.crates]]"
            icon="my-icons:ti-gift"
            type="success"
          ></pprdash-count>
          <pprdash-count
            class="col-lg-2 col-sm-6"
            text="Points"
            value="1234123"
            icon="my-icons:ti-game"
            type="info"
          ></pprdash-count>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="card card-user">
              <div class="image"></div>
              <div class="content">
                <div class="author">
                  <img class="avatar border-white" src="https://crafatar.com/avatars/[[uuid]]?overlay" alt="Head of [[username]]" />
                  <h4 class="title">[[username]]
                    <br />
                    <small>[[uuid]]</small>
                  </h4>
                </div>
                <p class="description text-center">
                  [[info.rank]]
                </p>
              </div>
              <hr>
              <div class="text-center">
                <div class="row">
                  <div class="col-md-6">
                    <h5>[[_dateFormat(info.firstLogin)]]
                      <br />
                      <small>First Login</small>
                    </h5>
                  </div>
                  <div class="col-md-6">
                    <h5>[[_dateFormat(info.lastLogin)]]
                      <br />
                      <small>Latest Login</small>
                    </h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card">
              <div class="header">
                <h4 class="title">Tokens and Points</h4>
              </div>
              <div class="content">
                <chart-js
                  id="pointsAndAchievementChart"
                  type="line"
                  options="[[pointsAchievementOptions]]"
                  data="[[pointsAchievementData]]"
                ></chart-js>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="header">
                <h4 class="title">Achievements</h4>
                <p class="category">by Gamemode
                  <p>
              </div>
              <div class="content">
                <canvas id="achievementChart" height="120"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card ">
              <div class="header">
                <h4 class="title">Medals</h4>
              </div>
              <div class="content">
                <canvas id="medalChart" height="140"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div>
          <ul class="nav nav-tabs" data-toggle="tabs">
            <li class="active">
              <a href="javascript:void()">The Herobrine</a>
            </li>
            <li class="">
              <a href="javascript:void()">Bed Wars</a>
            </li>
            <li class="">
              <a href="javascript:void()">Sky Wars</a>
            </li>
          </ul>
        </div>

        <hive-profile-game-tab gamemode="HB" player="[[uuid]]"></hive-profile-game-tab>
    </div>
  </div>
</div>

  </template>

  <script>
    let chartdata = [["2017-07-20T17:14:58.357Z", 64555], ["2017-07-21T00:10:46.086Z", 64605], ["2017-07-21T16:30:14.394Z", 64605], ["2017-07-22T00:15:53.626Z", 64605], ["2017-07-23T12:24:29.504Z", 64605], ["2017-07-24T00:15:57.019Z", 64605], ["2017-07-25T00:21:44.396Z", 64605], ["2017-07-26T00:15:57.698Z", 64605], ["2017-07-27T00:10:58.821Z", 64605], ["2017-07-28T00:15:21.973Z", 64605], ["2017-07-29T00:20:08.942Z", 64605], ["2017-07-30T00:19:00.919Z", 64605], ["2017-07-31T00:16:32.552Z", 64683], ["2017-08-01T00:18:35.055Z", 64683], ["2017-08-02T00:24:23.307Z", 64683], ["2017-08-03T00:14:01.352Z", 64683], ["2017-08-04T00:19:50.672Z", 64683], ["2017-08-05T00:22:57.476Z", 64683], ["2017-08-06T00:26:33.846Z", 64733], ["2017-08-07T00:31:55.953Z", 64883], ["2017-08-08T00:37:36.547Z", 65083], ["2017-08-09T00:39:19.951Z", 65183], ["2017-08-10T00:40:56.979Z", 65183], ["2017-08-10T21:14:13.171Z", 65333], ["2017-08-11T01:34:51.603Z", 65333], ["2017-08-12T00:55:35.563Z", 65483], ["2017-08-13T00:59:26.063Z", 65533], ["2017-08-14T01:04:01.710Z", 65533], ["2017-08-15T01:06:32.439Z", 65583], ["2017-08-16T01:08:53.842Z", 65733], ["2017-08-17T01:10:53.328Z", 65733], ["2017-08-18T01:12:29.658Z", 65783], ["2017-08-19T01:18:28.596Z", 65833], ["2017-08-20T01:23:46.691Z", 65883], ["2017-08-21T01:25:03.210Z", 65883], ["2017-08-22T01:25:30.922Z", 66083], ["2017-08-23T01:25:49.214Z", 66438], ["2017-08-24T01:26:49.864Z", 67108], ["2017-08-25T01:27:22.652Z", 67408], ["2017-08-28T13:18:15.502Z", 68163], ["2017-08-29T00:48:46.080Z", 68413], ["2017-08-30T00:51:42.541Z", 69063], ["2017-08-31T00:53:15.391Z", 69363], ["2017-09-01T00:56:32.955Z", 69713], ["2017-09-02T00:59:52.642Z", 70073], ["2017-09-04T01:02:43.898Z", 70531], ["2017-09-05T01:07:18.855Z", 70681], ["2017-09-05T13:42:56.661Z", 70681], ["2017-09-05T21:01:52.164Z", 70981], ["2017-09-06T00:47:24.266Z", 71031], ["2017-09-07T00:53:10.676Z", 71081], ["2017-09-07T13:43:56.645Z", 71181], ["2017-09-08T00:58:10.712Z", 71271], ["2017-09-08T18:43:46.119Z", 71461], ["2017-09-09T01:02:49.509Z", 71461], ["2017-09-10T01:23:38.830Z", 71561], ["2017-09-12T01:30:59.592Z", 72001], ["2017-09-13T01:32:35.214Z", 72101], ["2017-09-14T01:34:52.870Z", 73017], ["2017-09-14T15:42:27.034Z", 73117], ["2017-09-15T01:38:53.432Z", 72395], ["2017-09-16T00:51:32.444Z", 72620], ["2017-09-17T00:57:07.456Z", 73148], ["2017-09-18T01:05:45.256Z", 73348], ["2017-09-19T01:09:45.731Z", 73498], ["2017-09-20T01:10:15.948Z", 73598], ["2017-09-21T01:13:40.720Z", 73648], ["2017-09-22T01:16:47.194Z", 73898], ["2017-09-23T01:27:27.281Z", 74512], ["2017-09-24T01:30:13.686Z", 74562], ["2017-09-25T01:36:05.432Z", 74562], ["2017-09-26T01:38:44.059Z", 74812], ["2017-09-27T01:53:34.778Z", 74962], ["2017-09-28T01:53:28.470Z", 75112], ["2017-09-29T01:53:23.265Z", 75302], ["2017-09-30T01:54:54.564Z", 75552], ["2017-10-01T01:55:54.458Z", 76291], ["2017-10-01T02:15:27.234Z", 76291], ["2017-10-06T16:17:37.555Z", 77291], ["2017-10-07T00:48:32.891Z", 77291], ["2017-10-07T18:13:25.767Z", 77816], ["2017-10-08T00:49:43.675Z", 78406], ["2017-10-09T00:55:01.469Z", 78876], ["2017-10-09T14:53:01.865Z", 53576], ["2017-10-10T00:50:10.403Z", 53676], ["2017-10-11T00:55:06.600Z", 54071], ["2017-10-12T00:58:01.833Z", 54103], ["2017-10-13T01:12:01.729Z", 54253], ["2017-10-14T01:10:55.094Z", 54303], ["2017-10-15T00:54:35.815Z", 54303], ["2017-10-16T00:55:51.187Z", 54353], ["2017-10-17T01:02:52.577Z", 54403], ["2017-10-18T01:15:12.218Z", 54453], ["2017-10-18T18:58:26.913Z", 54453], ["2017-10-19T01:19:37.659Z", 54453], ["2017-10-20T01:24:47.008Z", 54453], ["2017-10-21T01:27:36.271Z", 54453], ["2017-10-22T01:31:22.817Z", 54453], ["2017-10-23T01:35:50.248Z", 54453], ["2017-10-24T01:39:40.967Z", 54631], ["2017-10-25T01:39:36.413Z", 54791], ["2017-10-26T01:40:08.104Z", 54847], ["2017-10-27T01:41:24.987Z", 54847]]
      .map(([a, b]) => { return { x: new Date(a), y: b } });

    let chartdata2 = [["2017-07-20T17:14:58.000Z", 118723], ["2017-07-21T00:10:46.000Z", 119103], ["2017-07-21T16:30:14.000Z", 119103], ["2017-07-22T00:15:53.000Z", 119103], ["2017-07-23T12:24:29.000Z", 119103], ["2017-07-24T00:15:57.000Z", 119103], ["2017-07-25T00:21:44.000Z", 119103], ["2017-07-26T00:15:57.000Z", 119103], ["2017-07-27T00:10:58.000Z", 119103], ["2017-07-28T00:15:21.000Z", 119103], ["2017-07-29T00:20:08.000Z", 119103], ["2017-07-30T00:19:00.000Z", 119103], ["2017-07-31T00:16:32.000Z", 119618], ["2017-08-01T00:18:35.000Z", 119618], ["2017-08-02T00:24:23.000Z", 119618], ["2017-08-03T00:14:01.000Z", 119618], ["2017-08-04T00:19:50.000Z", 119618], ["2017-08-05T00:22:57.000Z", 119733], ["2017-08-06T00:26:33.000Z", 120148], ["2017-08-07T00:31:55.000Z", 121263], ["2017-08-08T00:37:36.000Z", 122018], ["2017-08-09T00:39:19.000Z", 123348], ["2017-08-10T00:40:56.000Z", 123503], ["2017-08-10T21:14:13.000Z", 124523], ["2017-08-11T01:34:51.000Z", 124978], ["2017-08-12T00:55:35.000Z", 125928], ["2017-08-13T00:59:26.000Z", 126363], ["2017-08-14T01:04:01.000Z", 126503], ["2017-08-15T01:06:32.000Z", 126793], ["2017-08-16T01:08:53.000Z", 128298], ["2017-08-17T01:10:53.000Z", 128298], ["2017-08-18T01:12:29.000Z", 128473], ["2017-08-19T01:18:28.000Z", 128658], ["2017-08-20T01:23:46.000Z", 129118], ["2017-08-21T01:25:03.000Z", 129273], ["2017-08-22T01:25:30.000Z", 130528], ["2017-08-23T01:25:49.000Z", 131413], ["2017-08-24T01:26:49.000Z", 134588], ["2017-08-25T01:27:22.000Z", 136503], ["2017-08-28T13:18:15.000Z", 139868], ["2017-08-29T00:48:46.000Z", 141108], ["2017-08-30T00:51:42.000Z", 144898], ["2017-08-31T00:53:15.000Z", 147068], ["2017-09-01T00:56:32.000Z", 149043], ["2017-09-02T00:59:52.000Z", 151739], ["2017-09-04T01:02:43.000Z", 154397], ["2017-09-05T01:07:18.000Z", 155387], ["2017-09-05T13:42:56.000Z", 155387], ["2017-09-05T21:01:52.000Z", 156892], ["2017-09-06T00:47:24.000Z", 157082], ["2017-09-07T00:53:10.000Z", 157477], ["2017-09-07T13:43:56.000Z", 158357], ["2017-09-08T00:58:10.000Z", 158822], ["2017-09-08T18:43:46.000Z", 159127], ["2017-09-09T01:02:49.000Z", 159127], ["2017-09-10T01:23:38.000Z", 159727], ["2017-09-12T01:30:59.000Z", 162242], ["2017-09-13T01:32:35.000Z", 162952], ["2017-09-14T01:34:52.000Z", 165800], ["2017-09-14T15:42:27.000Z", 166300], ["2017-09-15T01:38:53.000Z", 168255], ["2017-09-16T00:51:32.000Z", 169250], ["2017-09-17T00:57:07.000Z", 172439], ["2017-09-18T01:05:45.000Z", 173619], ["2017-09-19T01:09:45.000Z", 174564], ["2017-09-20T01:10:15.000Z", 175389], ["2017-09-21T01:13:40.000Z", 175659], ["2017-09-22T01:16:47.000Z", 177454], ["2017-09-23T01:27:27.000Z", 181219], ["2017-09-24T01:30:13.000Z", 181634], ["2017-09-25T01:36:05.000Z", 181634], ["2017-09-26T01:38:44.000Z", 183409], ["2017-09-27T01:53:34.000Z", 184444], ["2017-09-28T01:53:28.000Z", 185169], ["2017-09-29T01:53:23.000Z", 186171], ["2017-09-30T01:54:54.000Z", 188021], ["2017-10-01T01:55:54.000Z", 190035], ["2017-10-01T02:15:27.000Z", 190035], ["2017-10-06T16:17:37.000Z", 195445], ["2017-10-07T00:48:32.000Z", 195670], ["2017-10-07T18:13:25.000Z", 197425], ["2017-10-08T00:49:43.000Z", 200622], ["2017-10-09T00:55:01.000Z", 202707], ["2017-10-09T14:53:01.000Z", 203122], ["2017-10-10T00:50:10.000Z", 203947], ["2017-10-11T00:55:06.000Z", 206462], ["2017-10-12T00:58:01.000Z", 206917], ["2017-10-13T01:12:01.000Z", 207862], ["2017-10-14T01:10:55.000Z", 208018], ["2017-10-15T00:54:35.000Z", 209886], ["2017-10-16T00:55:51.000Z", 210723], ["2017-10-17T01:02:52.000Z", 211292], ["2017-10-18T01:15:12.000Z", 211540], ["2017-10-18T18:58:26.000Z", 211540], ["2017-10-19T01:19:37.000Z", 211540], ["2017-10-20T01:24:47.000Z", 211540], ["2017-10-21T01:27:36.000Z", 211540], ["2017-10-22T01:31:22.000Z", 211540], ["2017-10-23T01:35:50.000Z", 211540], ["2017-10-24T01:39:40.000Z", 212039], ["2017-10-25T01:39:36.000Z", 213122], ["2017-10-26T01:40:08.000Z", 213301], ["2017-10-27T01:41:24.000Z", 213301]]
      .map(([a, b]) => { return { x: new Date(a), y: b } });

    class HiveProfile extends Polymer.Element {
      static get is() { return 'hive-profile'; }
      static get properties() {
        return {
          player: {
            type: Object,
            value: {
              name: "Lergin_",
              uuid: "ebdf264aabda45708f61f2d7a2bb4758",
              rank: "Regular Hive Member"
            }
          },
          preProcessAchievements: {
            type: Array
          }
        }
      }

      static get observers(){
        return [
          '_preProcessAchievements(gameInfo.achievements)'
        ]
      }

      ready(){
        super.ready();
        
        this.pointsAchievementData= {
          datasets: [{
            label: "Tokens",
            data: chartdata,
            backgroundColor: "#2196F3",
            borderColor: "#2196F3",
            fill: false
          },
          {
            label: "Total Points",
            data: chartdata2,
            borderColor: "#FF5722",
            backgroundColor: "#FF5722",
            fill: false
          }]
        }

        this.pointsAchievementOptions = {
          responsive: true, scales: {
            xAxes: [{
              type: "time", display: true, scaleLabel: {
                display: true, labelString:
                  'Date'
              }
            }], yAxes: [{ display: true, ticks: { beginAtZero: true } }]
          }
        }
      }
      _dateFormat(date){
        return new Date(date).toLocaleDateString()
      }
      _numFormat(num) {
        return new Number(num).toLocaleString();
      }
      _textFormat(str){
        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
      }
      async _preProcessAchievements(){
        if(!this.gameInfo.achievements) return;

        let achievements = await hive.GameTypes.list.find(a => a.id == "HB").achievements();

        console.log(achievements)


        this.gameInfo.achievements.forEach(achie => {
          let a = achievements.find(a => a.id == achie.id);

          if(a == undefined){
            achie.name = achie.id;
            achievements.push(achie)
            console.error("unknown achievmenet:", achie)
            return;
          }

          a.progress = achie.progress;
          a.unlockedAt = achie.unlockedAt;
          a.unlocked = achie.unlocked;
        });

        this.preProcessAchievements = achievements;
        return achievements;

        console.log("A")

        this.preProcessAchievements =  await Promise.all(this.gameInfo.achievements.map(async a => {
          console.log(a)
          let info = await a.info();
          a.id = info.id;
          a.name = info.name;
          a.description = info.description;
          a.stages = info.stages;
          return a;
        }));
      }
    }

      window.customElements.define(HiveProfile.is, HiveProfile);

  </script>
</dom-module>