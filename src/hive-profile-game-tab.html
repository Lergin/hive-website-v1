<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="hive-profile-styles.html">
<link rel="import" href="hive-achievements-card.html">
<link rel="import" href="chart-js.html">

<link rel="import" href="hive-api-player.html">

<dom-module id="hive-profile-game-tab">
  <template>
    <style include="hive-profile-styles">
      :host {
        display: block;
      }

      [hidden] {
        display: none;
      }
    </style>
    <hive-api-player id="hiveApi" player="[[player]]" game="[[gamemode]]" api-player-game-info="{{gameInfo}}"></hive-api-player>

    <template is="dom-if" if="[[_hideGameInfo(gameInfo)]]">
      <div class="row">
        <div class="col-md-12">
          <div class="card ">
            <div class="content">
              No data about this game <small>([[gamemode]])</small>! The player has probably never played this game :(
            </div>
          </div>
        </div>
      </div>
    </template>

    <div class="row" hidden="[[_hideGameInfo(gameInfo)]]">
      <div class="col-md-4">
        
        
        <hive-game-player-info-card gamemode="[[gamemode]]" points="[[gameInfo.points]]" player-title="[[gameInfo.title]]">
          <div slot="stats" class="row">
            <template is="dom-repeat" items="[[compStats]]">
              <div class="col-md-4">
                <h5>[[item.value]]
                  <br />
                  <small>[[item.title]]</small>
                </h5>
              </div>
            </template>
          </div>
          <div class="row" slot="logins">
            <template is="dom-repeat" items="[[compLogins]]">
              <div class$="[[loginClass]]">
                <h5>[[item.value]]
                  <br />
                  <small>[[item.title]]</small>
                </h5>
              </div>
            </template>
          </div>
        </hive-game-player-info-card>

        <hive-achievements-card hidden="[[!preProcessedAchievements]]" achievements="[[preProcessAchievements]]"></hive-achievements-card>
      </div>
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-12">
            <div class="card ">
              <div class="header">
                <h4 class="title">Points</h4>
              </div>
              <div class="content">
                <firebase-document
                  path="playerStats/data/[[player]]/points/[[gamemode]]"
                  data="{{points}}">
                </firebase-document>
                
                <chart-js
                  type="line"
                  options="[[pointChartOptions]]"
                  data="[[_calcPointChartData(points)]]" 
                  height="140"
                ></chart-js>
              </div>
            </div>
          </div>
          <template is="dom-if" if="[[preProcessAchievements]]">
            <div class="col-md-12">
              <div class="card ">
                <div class="header">
                  <h4 class="title">Achievements</h4>
                </div>
                <div class="content">
                  <firebase-document path="playerStats/data/[[player]]/achievements/[[gamemode]]" data="{{achievements}}">
                  </firebase-document>

                  <chart-js type="line" options="[[achievementChartOptions]]" data="[[_calcAchievementChartData(achievements)]]" height="140"></chart-js>
                </div>
              </div>
            </div>
          </template>
          
        </div>

      </div>
  </template>

  <script>
    const numFormat = a => new Number(a || 0).toLocaleString();
    const strFormat = a => a?a.charAt(0).toUpperCase() + a.slice(1).toLowerCase():"";
    const dateFormat = a => new Date(a).toLocaleDateString();
    const boolFormat = a => strFormat(`${(a == undefined) ? "false" : a.toString()}`) + "â€‹";
    const timeFormat = a => `${Math.floor(a / (60 * 60))}:${Math.floor(a / 60) - Math.floor(a / (60 * 60)) * 60}:${a - Math.floor(a / 60) * 60}`;
    const subPropCount = a => b => b ? numFormat(b[a]) : 0;
    /**
     * creates the text for an unlock that has the amount stored in an enum onder the hive api libary
     * a : name of the enum
     * b : array of unlocks
     */
    const unlocks = a => b =>  `${numFormat(b ? b.length : 0)} / ${enumAmount(a)}`;
    const enumAmount = a => Object.keys(hive[a]).length;

    const gameModeConfigs = {
      BD: {
         stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Energy Collected",
            prop: "energyCollected",
            func: numFormat
          },
          {
            title: "Batteries Charged",
            prop: "batteriesCharged",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      BED: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Beds Destroyed",
            prop: "bedsDestroyed",
            func: numFormat
          },
          {
            title: "Teams Eliminated",
            prop: "teamsEliminated",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      BP: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Eliminations",
            prop: "totalElimination",
            func: numFormat
          }, 
          {
            title: "Placings",
            prop: "totalPlacing",
            func: numFormat
          },
          {
            title: "Selected Bling",
            prop: "selectedBling",
            func: strFormat
          },
          {
            title: "Blings Unlocked",
            prop: "unlockedBling",
            func: unlocks("BpBling")
          },
          {
            title: "Selected Death Sound",
            prop: "selectedDeathSound",
            func: strFormat
          },
          {
            title: "Death Sounds Unlocked",
            prop: "unlockedDeathSounds",
            func: unlocks("BpDeathSound")
          },
          {
            title: "Selected Trail",
            prop: "selectedTrail",
            func: strFormat
          },
          {
            title: "Trails Unlocked",
            prop: "unlockedTrails",
            func: unlocks("BpTrail")
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          }
        ]
      },
      CAI: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Captures",
            prop: "captures",
            func: numFormat
          },
          {
            title: "Captured",
            prop: "captured",
            func: numFormat
          },
          {
            title: "Catches",
            prop: "catches",
            func: numFormat
          },
          {
            title: "Caught",
            prop: "caught",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      CR: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "RCCAT Count",
            prop: "rccatCount",
            func: numFormat
          },
          {
            title: "RCCAT Kills",
            prop: "rccatKills",
            func: numFormat
          },
          {
            title: "Airstrice Count",
            prop: "airstrikeCount",
            func: numFormat
          },
          {
            title: "Airstrice Kills",
            prop: "airstrikeKills",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      DRAW: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Correct Guesses",
            prop: "correctGuesses",
            func: numFormat
          },
          {
            title: "Incorrect Guesses",
            prop: "incorrectGuesses",
            func: numFormat
          },
          {
            title: "Skips",
            prop: "skips",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          }
        ]
      },
      DR: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Games as Death",
            prop:"deathGamesPlayed",
            func: numFormat
          },
          {
            title: "Wins as Death",
            prop:"deathWins",
            func: numFormat
          },
          {
            title: "Games as Runner",
            prop:"runnerGamesPlayed",
            func: numFormat
          },
          {
            title: "Wins as Runner",
            prop:"runnerWins",
            func: numFormat
          },
          {
            title: "Checkpoints passed",
            prop:"totalCheckpoints",
            func: numFormat
          },
          {
            title: "Traps activated",
            prop:"trapsActivated",
            func: numFormat
          },
          {
            title: "Runner Visibility",
            prop: "visibility",
            func: strFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      EF: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Blocks activated",
            prop: "blocksactivated",
            func: numFormat
          },
          {
            title: "Players outlived",
            prop: "outlived",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      HB: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Captures",
            prop: "captures",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Active Class",
            prop: "activeClass",
            func: strFormat
          },
          {
            title: "Classes Unlocked",
            prop: "unlockedClasses",
            func: unlocks("HbClass")
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          }
        ]
      },
      HERO: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "One vs One wins",
            prop: "oneVsOnesWins",
            func: numFormat
          },
          {
            title: "Deathmatches",
            prop: "deathmatches",
            func: numFormat
          },
          {
            title: "TNT used",
            prop: "tntUsed",
            func: numFormat
          },
          {
            title: "Food consumed",
            prop: "foodConsumed",
            func: numFormat
          },
          {
            title: "Crates opened",
            prop: "cratesOpened",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      HIDE: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Time Alive",
            prop: "timeAlive",
            func: timeFormat
          },
          {
            title: "Unlocked Blocks",
            prop: "blocks",
            func: a => a ? a.length : 0
          },
          {
            title: "Hider Kills",
            prop: "hiderKills",
            func: numFormat
          },
          {
            title: "Seeker Kills",
            prop: "seekerKills",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      LAB: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Rocket Race Victories",
            prop: "gameVictories",
            func: subPropCount("ROCKETRACE")
          },
          {
            title: "Breaking Blocks Victories",
            prop: "gameVictories",
            func: subPropCount("BREAKINGBLOCKS")
          },
          {
            title: "Fight Victories",
            prop: "gameVictories",
            func: subPropCount("FIGHT")
          },
          {
            title: "Dodgeball Victories",
            prop: "gameVictories",
            func: subPropCount("DODGEBALL")
          },
          {
            title: "Balloon Pop Victories",
            prop: "gameVictories",
            func: subPropCount("BALLOONPOP")
          },
          {
            title: "Boat Wars Victories",
            prop: "gameVictories",
            func: subPropCount("BOATWARS")
          },
          {
            title: "Crazy Paint Victories",
            prop: "gameVictories",
            func: subPropCount("CRAZYPAINT")
          },
          {
            title: "Gold Rush Victories",
            prop: "gameVictories",
            func: subPropCount("GOLDRUSH")
          },
          {
            title: "Splegg Victories",
            prop: "gameVictories",
            func: subPropCount("SPLEGG")
          },
          {
            title: "Pig Raicing Victories",
            prop: "gameVictories",
            func: subPropCount("PIGRACING")
          },
          {
            title: "Whack a Mob Victories",
            prop: "gameVictories",
            func: subPropCount("WHACKAMOB")
          },
          {
            title: "Catastrophic Victories",
            prop: "gameVictories",
            func: subPropCount("CATASTROPHIC")
          },
          {
            title: "Snowman Victories",
            prop: "gameVictories",
            func: subPropCount("SNOWMAN")
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      MIMV: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Latest Emote",
            prop: "lastUsedEmote",
            func: strFormat
          },
          {
            title: "Emote Selector",
            prop: "preferredEmoteSelectorMenu",
            func: a => a ? a.replace("EmoteSelectorMenu", "") : 0
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      MM: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Correct Notes",
            prop: "correctNotes",
            func: numFormat
          },
          {
            title: "Incorrect Notes",
            prop: "incorrectNotes",
            func: numFormat
          },
          {
            title: "Perfect Notes",
            prop: "perfectNotes",
            func: numFormat
          },
          {
            title: "Good Notes",
            prop: "goodNotes",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      OITC: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Arrows Fired",
            prop: "arrowsFired",
            func: numFormat
          },
          {
            title: "Cupid Unlock",
            prop: "cupidUnlock",
            func: boolFormat
          },
          {
            title: "Rainbow Unlock",
            prop: "rainbowUnlock",
            func: boolFormat
          },
          {
            title: "Music Unlock",
            prop: "musicUnlock",
            func: boolFormat
          },
          {
            title: "Herobrine Unlock",
            prop: "herobrineUnlock",
            func: boolFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      RR: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Tables Cleared",
            prop: "tablesCleared",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      SGN: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Most Points",
            prop: "mostPoints",
            func: numFormat
          },
          {
            title: "Crates opened",
            prop: "cratesOpened",
            func: numFormat
          },
          {
            title: "Deathmatches",
            prop: "deathMatches",
            func: numFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      SKY: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Most Points",
            prop: "mostPoints",
            func: numFormat
          },
          {
            title: "Time Alive",
            prop: "timeAlive",
            func: timeFormat
          },
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      SLAP: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      SP: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Eggs fired",
            prop: "eggsFired",
            func: numFormat
          },
          {
            title: "Blocks Destroyed",
            prop: "blocksDestroyed",
            func: numFormat
          },
          {
            title: "Time Alive",
            prop: "timeAlive",
            func: timeFormat
          }
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      SPL: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Victories",
            prop: "victories",
            func: numFormat
          },
          {
            title: "Games Played",
            prop: "gamesPlayed",
            func: numFormat
          },
          {
            title: "Kills",
            prop: "kills",
            func: numFormat
          },
          {
            title: "Deaths",
            prop: "deaths",
            func: numFormat
          },
          {
            title: "Blocks Painted",
            prop: "blocksPainted",
            func: numFormat
          },
          {
            title: "Ultimates Earned",
            prop: "ultimatesEarned",
            func: numFormat
          }
          // characterStats missing
        ],
        logins: [
          {
            title: "First Login",
            prop: "firstLogin",
            func: dateFormat
          },
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
      TIMV: {
        stats: [
          {
            title: "Points",
            prop: "points",
            func: numFormat
          },
          {
            title: "Most Points",
            prop: "mostPoints",
            func: numFormat
          },
          {
            title: "Role Points",
            prop: "rolePoints",
            func: numFormat
          },
          {
            title: "Traitor Points",
            prop: "traitorPoints",
            func: numFormat
          },
          {
            title: "Innocent Points",
            prop: "innocentPoints",
            func: numFormat
          },
          {
            title: "Detective Points",
            prop: "detectivePoints",
            func: numFormat
          },
          {
            title: "Active Detective Stick",
            prop: "activeDetectiveStick",
            func: strFormat
          },
          {
            title: "Unlocked Detective Sticks",
            prop: "detectiveSticks",
            func: unlocks("TimvDetectiveStick")
          },
          {
            title: "Active Flare",
            prop: "activeFlareUpgrade",
            func: strFormat
          },
          {
            title: "Unlocked Flares",
            prop: "flareUpgrades",
            func: unlocks("TimvFlare")
          },
          {
            title: "Detective Book",
            prop: "detectiveBook",
            func: boolFormat
          },
        ],
        logins: [
          {
            title: "Latest Login",
            prop: "lastLogin",
            func: dateFormat
          }
        ]
      },
    }

    class HiveProfileGameTab extends Polymer.Element {
      static get is() { return 'hive-profile-game-tab'; }
      static get properties() {
        return {
          gamemode: String,
          player: String,
          preProcessAchievements: {
            type: Array
          },
          compStats: {
            computed: '_computeStats(gamemode, gameInfo)'
          },
          compLogins: {
            computed: '_computeLogins(gamemode, gameInfo)'
          },
          loginClass: {
            computed: '_computeLoginClass(compLogins)'
          },
          pointChartOptions: {
            type: Object,
            value: {
              responsive: true,
              legend: {
                display: false
              },
              scales: {
                xAxes: [{
                  type: "time",
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Date'
                  },
                }],
                yAxes: [{
                  display: true,
                  ticks: {
                    beginAtZero: true,

                  }
                }]
              }
            }
          },
          achievementChartOptions: {
            type: Object,
            value: {
              responsive: true,
              legend: {
                display: false
              },
              scales: {
                xAxes: [{
                  type: "time",
                  display: true,
                  scaleLabel: {
                    display: true,
                    labelString: 'Date'
                  },
                }],
                yAxes: [{
                  display: true,
                  ticks: {
                    beginAtZero: true,

                  }
                }]
              }
            }
          }
        }
      }

      static get observers() {
        return [
          '_preProcessAchievements(gameInfo.achievements)'
        ]
      }

      _hideGameInfo(a){
        return a == undefined || a.points === 0;
      }

      toDateValue([a, b]){ return { x: new Date(new Number(a)), y: b } };

      _calcPointChartData(points){
        return {
          datasets: [{
            label: "Points",
            data: Object.entries(points).map(this.toDateValue),
            backgroundColor: "#2196F3",
            borderColor: "#2196F3",
            fill: false
          }]
        }
      }

      _calcAchievementChartData(achievemenets){
        return {
          datasets: [{
            label: "Achievements",
            data: Object.entries(achievemenets).map(this.toDateValue),
            backgroundColor: "#2196F3",
            borderColor: "#2196F3",
            fill: false
          }]
        }
      }

      _computeStats(gamemode, gameInfo) {
        if (!gameInfo) return;

        return gameModeConfigs[gamemode].stats.map(a => {
          if(a.func(gameInfo[a.prop])){
            return {
              title: a.title,
              value: a.func(gameInfo[a.prop])
            }
          }
        }).filter(a=>a);
      }

      _computeLogins(gamemode, gameInfo) {
        if (!gameInfo) return;

        return gameModeConfigs[gamemode].logins.map(a => {
          return {
            title: a.title,
            value: a.func(gameInfo[a.prop])
          }
        })
      }

      _computeLoginClass(logins){
        return `col-md-${Math.floor(12 / logins.length)}`;
      }

      _dateFormat(date) {
        return new Date(date).toLocaleDateString()
      }

      _numFormat(num) {
        return new Number(num).toLocaleString();
      }

      _textFormat(str) {
        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
      }

      async _preProcessAchievements() {
        if (!this.gameInfo.achievements) return;

        let achievements = await hive.GameTypes.list.find(a => a.id == this.gamemode).achievements();

        this.gameInfo.achievements.forEach(achie => {
          let a = achievements.find(a => a.id == achie.id);

          if (a == undefined) {
            achie.name = achie.id;
            achievements.push(achie)
            console.debug("unknown achievmenet:", achie)
            return;
          }

          a.progress = achie.progress;
          a.unlockedAt = achie.unlockedAt;
          a.unlocked = achie.unlocked;
        });

        this.preProcessAchievements = achievements;
        return achievements;

        console.log("A")

        this.preProcessAchievements = await Promise.all(this.gameInfo.achievements.map(async a => {
          console.log(a)
          let info = await a.info();
          a.id = info.id;
          a.name = info.name;
          a.description = info.description;
          a.stages = info.stages;
          return a;
        }));
      }
    }

    window.customElements.define(HiveProfileGameTab.is, HiveProfileGameTab);

  </script>
</dom-module>